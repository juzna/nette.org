MultipleFileUpload
******************

.[perex]
MultipleFileUpload (zkráceně MFU) je doplněk pro Nette Framework, který vašim uživatelům umožní pohodlně, jednoduše a interaktivně odesílat hromady souborů. Komfort nabízí nejen uživateli, ale i programátorovi. Uživatel může na pár kliknutí odeslat celé fotoalbum a programátorovi stačí na implementaci tohoto doplňku pouhé 2 řádky kódu. Navíc tento doplněk podporuje AJAX pro maximální rychlost a uživatelské pohodlí! I na uživatele se staršími prohlížeči se myslelo. Pokud prohlížeč nesplňuje minimální požadavky, uživatel může odeslat soubory standardním způsobem.




|Autor doplňku  | Honza Kuchař
|Autor driver(ů)| Honza Kuchař (sqlite a log driver), Martin Sadový (dibi driver)
|Inspirováno    | http://forum.nette.org/cs/viewtopic.php?pid=15098#p15098
|Licence        | New BSD License
|Diskuse        | http://forum.nette.org/cs/2386-addon-multiplefileupload-multiplefileupload-form-control
|Demo           | http://multiplefileupload.projekty.mujserver.net/
|Stav           | **Ve vývoji.** Návrhy jak by jste si představovali finální podobu, piště na fórum. Jsou přijímány návrh jak na implementaci, tak na vizuální podobu.
|Nette          | viz závislosti





Instalace
---------

1. Zkopírujte následující soubory:
  - app/controls/MultipleFileUpload
  - document_root/css/uploadify.css
  - document_root/images/*
  - document_root/js/*
  - document_root/swf/*

2. Do bootstrapu za registraci "RobotLoaderu":http://doc.nette.org/cs/nette-loaders#toc-nette-loaders-robotloader a před `$application->run();` přidejte následující řádku.
  /---code php
  MultipleFileUpload::register();
  \---
  Tímto krokem načtete a zaregistrujete *Multiple File Upload*.

.[note]
Pokud používáte Nette 0.9.2 nebo nižší, čtěte zde: http://forum.nette.org/cs/2566-httpuploadedfile-bug-pri-safe-mode-nema-opravneni-pri-presunu-souboru . V Nette 0.9.3-RC je už tato "chyba" opravena. http://github.com/dg/nette/commit/f36e5f07e0df3580ebae8a3b26562f8ae53e84a1

A potom už můžete **začít Multiple File Uploader používat**.





Použití
-------
/---code php
$f = new AppForm($this,$name);

$f->addMultipleFileUpload("pokus1","Testík",20)
    ->addRule("MultipleFileUpload::validateFilled","Musíte odeslat alespoň jeden soubor!")
    ->addRule("MultipleFileUpload::validateFileSize","Soubory jsou dohromady moc veliké!",1024); // 1 KB
\---
.[note]
Do formuláře je potřeba opravdu zadávat přímo callback, protože ZATÍM není podporována validace na straně klienta!

Jako hodnotu MFU ve formuláři dostanu pole ve kterém je každý soubor validní (prošel HttpUploadedFile::isOK()) a je instancí HttpUploadedFile. Všechny soubory co zůstanou v tempech po odeslání formuláře budou smazány.

Takto vypadá pole co dostanete ke zpracování (`$hodnoty = $form->getValues();`):
/---code php
array(1) {
      0 => object(HttpUploadedFile) (5) {
         "name" private => string(15) "application.ini"
         "type" private => string(24) "application/octet-stream"
         "size" private => int(164)
         "tmpName" private => string(107) "xxx"
         "error" private => int(0)
      }
}
\---

Vzhled prvku můžete upravovat v šablonách `MultipleFileUpload-withJS.phtml` a `MultipleFileUpload-withoutJS.phtml`. Popřípadě zde můžete i měnit nastavení uploadify.






Podpora v prohlížečích
----------------------

|-----------------------------------------------------------------
| Prohlížeč          | Verze             | Kvalita podpory            | Komentář
|-----------------------------------------------------------------
| Google Chrome      |    2              | <b> ***** </b> .<> | Bez výhrad
|                   ^| 4.1.249.1025 beta | <b> ***** </b> .<> | Bez výhrad
| Opera              |   10.0            | <b> ***** </b> .<> | Bez výhrad
|                   ^|   9.65            | <b> ***** </b> .<> | Bez výhrad
| Firefox            |   3.5             | <b> ****  </b> .<> | O něco pomalejší než Google Chrome a Opera. Možná je to ale způsobeno nějakým nainstalovaným doplňkem.
|                   ^|   3.6             | <b> ****  </b> .<> | O něco pomalejší než Google Chrome a Opera. Možná je to ale způsobeno nějakým nainstalovaným doplňkem.
| Internet Explorer  | všechny           |  -             .<> | Mezi soubory z nějakých důvodů chvíli čeká. Potřeba ošetřit několik workaroundů, aby to vůbec jelo. (viz Závislosti)
|                   ^|    8              | <b> ***   </b> .<> | Soubory odesílá klidně v deseti vláknech. (ale každé vlákno vždy chvíli čeká) Tzn. funguje to v celku správně.
|                   ^|    6              | <b> *     </b> .<> | Soubory odesílá pouze v jednom vlákně. Tzn. taky to nějak funguje.





Závislosti
----------

- minimální verze Nette 0.9.1, 0.9.2 (nutnost přepsat "HttpUploadedFile::move()":http://forum.nette.org/cs/2566-httpuploadedfile-bug-pri-safe-mode-nema-opravneni-pri-presunu-souboru)
- **doporučená verze Nette 0.9.3**
- JavaScript: [jQuery | http://jquery.com/], [Uploadify | http://www.uploadify.com/], [swfobject.js | http://code.google.com/p/swfobject/], [livequery | http://plugins.jquery.com/project/livequery/], [upravený ajax-form driver | https://guest:@svn.mujserver.net:8443/svn/Nette_MultipleFileUpload/trunk/document_root/js/nette-ajax-form.js]
- originální `jquery.uploadify.js` nefunguje s Internet Explorerem, protože má v id objektu pomlčku. IE to interpretuje jako mínus. Proto jsem vydal upravenou verzi, kterou najdete na svn ve složce `trunk/document_root/js/`. (od rev. 19)
- originální `swfobject.js` nefunguje v Internet Exploreru, protože Internet Explorer má bug s flashem ve formuláři. Upravenou verzi tohoto souboru najdete na svn ve složce `trunk/document_root/js/`. (od rev. 20)





Drivery
-------

Driver má za úkol skladovat informace o přenesených souborech a samotné soubory. V Multiple File Uploadu se driverů nachází hned několik.

Jak zaregistrovat vlastní driver? Mrkněte do bootstrapu v distribuci.

|-----------------------------------------------------------------
| Driver              | Autor                      | Licence  | Umístění | Thread-safe   | Popis | Instalace
|-----------------------------------------------------------------
| **SQLite v. 2**     | "Honza Kuchař":http://forum.nette.org/cs/profile.php?id=1018 | New BSD | distribuce | ano | Ukládá informace o přenesených souborech do databáze SQLite. (využívá php_sqlite; nevyžaduje dibi) | Stačí povolit zápis (chmod(0777)) ve složce app/controls/drivers/Sqlite/database.sdb.
| **Dibi**            | "Martin Sadový":http://forum.nette.org/cs/profile.php?id=1876 (prvotní implementace) + "Honza Kuchař":http://forum.nette.org/cs/profile.php?id=1018 (učesáno; přidán workaround pro http://forum.dibiphp.com/cs/1003-pgsql-a-znak-x00-oriznuti-zbytku-vstupu?pid=3840#p3840) | New BSD  | distribuce | ano | Ukládá informace o přenesených souborech do jakékoli databáze, kterou podporuje Dibi. (vyžaduje Dibi; tabulku musíte v databázi ručně vytvořit; v distribuci přiloženy dumpy databází mysql (Martin) a postgres (Honza)) | Zprovozníte dibi, vytvoříte tabulku files v databázi. (viz dumpy databází)
| **Log**             | "Honza Kuchař":http://forum.nette.org/cs/profile.php?id=1018 | New BSD | distribuce | ano | Nikam nic neukládá. Slouží pro vývojáře k zjištění pořadí volaných metod v driveru. Pro běžného uživatele nemá žádný význam. | Nakonfigurovat Logger. (viz doplňky)







Demo
----
http://multiplefileupload.projekty.mujserver.net/

<iframe width="100%" height="750" frameborder="3" src="http://multiplefileupload.projekty.mujserver.net/"></iframe>





SVN
---
https://guest:@svn.mujserver.net:8443/svn/Nette_MultipleFileUpload/trunk/


{{extras}}

{{author: Honza Kuchař|1018}}
