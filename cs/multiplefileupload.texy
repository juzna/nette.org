MultipleFileUpload - form control
*********************************

|Autor | Honza Kuchař
|Inspirováno | http://forum.nette.org/cs/viewtopic.php?pid=15098#p15098
|Licence | New BSD License
|Diskuse | http://forum.nette.org/cs/2386-addon-multiplefileupload-multiplefileupload-form-control
|Demo | http://multiplefileupload.projekty.mujserver.net/
|Stav | Ve vývoji. Návrhy jak by jste si představovali finální podobu, piště na fórum.

Instalace
---------

Zkopírujte následující soubory:
- app/MultipleFileUpload
- document_root/css/uploadify.css
- document_root/images/*
- document_root/js/*
- document_root/swf/*

do bootstrapu přidejte
/---code php
MultipleFileUpload::register();
\---

Přepsat metodu třídy HttpUploadedFile move() (libs\Nette\Web\HttpUploadedFile.php:175) na:
/---code php
        /**
         * Move uploaded file to new location.
         * @param  string
         * @return bool
         *
         * @author David Grudl, Jan Kuchar
         * @link http://forum.nette.org/cs/2566-httpuploadedfile-bug-pri-safe-mode-nema-opravneni-pri-presunu-souboru
         */
        public function move($dest)
        {
                if (move_uploaded_file($this->tmpName, $dest)) {
                        $this->tmpName = $dest;
                        return TRUE;

                } else {
                        @unlink($dest); // needed in PHP < 5.3 & Windows; intentionally @
                        if(rename($this->tmpName, $dest)) {
                                $this->tmpName = $dest;
                                return TRUE;

                        } else {
                                if(copy($this->tmpName, $dest)){
                                    unlink($this->tmpName);
                                    $this->tmpName = $dest;
                                    return TRUE;
                                }
                                return FALSE;
                        }
                }
        }
\---
.[note]
Tato úprava je jen dočasná, než se vyřeší toto: http://forum.nette.org/cs/2566-httpuploadedfile-bug-pri-safe-mode-nema-opravneni-pri-presunu-souboru


A potom už můžete **začít MultipleFileUpload používat**.

Použití
-------
/---code php
$f = new AppForm($this,$name);

$f->addMultipleFileUpload("pokus1","Testík",20)
    ->addRule("MultipleFileUpload::validateFilled","Musíte odeslat alespoň jeden soubor!")
    ->addRule("MultipleFileUpload::validateFileSize","Soubory jsou dohromady moc veliké!",1024); // 1 KB
\---
.[note]
Do formuláře je přeba opravdu zadávat přímo callback, protože ZATÍM není podporována validace na straně klienta!

Jako value tohoto controlu dostanu pole ve kterém je každý soubor validní (prošel isOK()) a je instancí HttpUploadedFile. Všechny soubory co zůstanou v tempech po odeslání formuláře budou smazány.

Takto vypadá pole co dostanete ke zpracování:
/---code php
array(1) {
      0 => object(HttpUploadedFile) (5) {
         "name" private => string(15) "application.ini"
         "type" private => string(24) "application/octet-stream"
         "size" private => int(164)
         "tmpName" private => string(107) "xxx"
         "error" private => int(0)
      }
}
\---

Vzhled prvku můžete upravovat v šablonách `MultipleFileUpload-withJS.phtml` a `MultipleFileUpload-withoutJS.phtml`. Popřípadě zde můžete i měnit nastavení uploadify.

.[caution]
Tento form control má zatím [chybku | http://forum.nette.org/cs/viewtopic.php?pid=18187#p18187] na linuxových serverech. Já přístup na linuxovou mašinu nemám. Takže vás poprosím, kdo má a je ochoten obětovat chvilku svého času, tak ať se pokusí tento control debugovat.

.[note]
Tento form control zatím není tread-safe, takže MUSÍTE používat uploadify s volbou `simUploadLimit: 1`.

Podpora v prohlížečích
----------------------

|----------------------------------------------------
| Prohlížeč       | Hodnocení          | Poznámka
|----------------------------------------------------
| Firefox 3.5     | <b> ***** </b> .<> | Bez výhrad
| Google Chrome 2 | <b> ***** </b> .<> | Bez výhrad
| Opera 10.0      | <b> ***** </b> .<> | Bez výhrad
| IE 8            | <b> ***   </b> .<> | Rychlost odesílání - mezi soubory z nějakých důvodů chvíli čeká

Závislosti
----------

- doporučená verze 0.9.1 (s nutností přepsat HttpUploadedFile::move())
- JavaScript: [jQuery | http://jquery.com/], [Uploadify | http://www.uploadify.com/], [swfobject.js | http://code.google.com/p/swfobject/], [livequery | http://plugins.jquery.com/project/livequery/], [upravený ajax-form driver | https://guest:@svn.mujserver.net:8443/svn/Nette_MultipleFileUpload/trunk/document_root/js/nette-ajax-form.js]

Demo
----
http://multiplefileupload.projekty.mujserver.net/

<iframe width="100%" height="600" frameborder="3" src="http://multiplefileupload.projekty.mujserver.net/"></iframe>

SVN
---
https://guest:@svn.mujserver.net:8443/svn/Nette_MultipleFileUpload/trunk/

{{extras}}

{{author: Honza Kuchař|1018}}
