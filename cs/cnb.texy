Exchange - aktuální kurzovní lístek
********************


.[perex]
Třída Cnb byla přejmenována na Exchange, protože nyní nejste omezeni pouze Českou Národní Bankou, ale můžete si nastavit kurzovní lístek odkudkoliv, pokud dodržíte interface. Pomocí třídy **Exchange**, skript napsaný v PHP, můžete stáhnout libovolnou měnu a nechat ji na jakoukoliv přepočítat. Případně zformátovat.

|* Verze 3 | 3.1 (1.7.2012) stable (php >= 5.3) - [ github| https://github.com/h4kuna/Exchange/archives/master ]
|* Ukázka | zatím není
|* Fórum | http://forum.nette.org/cs/1880-cnb-ceska-narodni-banka?pid=35604#p35604
|* Autor | Milan Matějček ([h4kuna | http://forum.nette.org/cs/profile.php?id=1966])
|* Licence | New BSD License
|* Vývoj od | 3/2009

Instalace
---------
Po stažení a rozbalení bylo všechno naházeno do složek a viditelný je na první pohled pouze Exchange.php. Celá knihovna je v namespace Exchange.


2.x vs 3.x
------------
Došlo k jistým změnám, kompatibilní je jen metoda **format()**. Základní rozdělení je:
-stahování (libs\Download.php, Cnb\CnbDay.php) + libs\CUrl.php
-uložiště (libs\Storage.php, Cnb\CnbStorage.php)
-formátování čísel (libs\NumberFormat.php) **nová třída**
-to celé zastřešuje Exchange\Exchange.
Vše se nechá ovlivnit přes config.neon, ukázka je v _plan\config.neon, pravděpodobně se ještě změní.

Co umí
------------
-práce se session nativně ukládá poslední použitou měnu a zobrazení s dph nebo bez
-lze použít i pro zahraniční e-shop, protože nemusí využívat kourunu českou
-nezáleží na používání velikosti písma při definování měny např:(EUR, eur, eUr)
-metoda format() upravý měnu podle uživatelsky definované předlohy, výsledek tvoří validní UTF-8, **tzn: usd->$1 000.00, eur->€1.000,00, czk->1 000 Kč**, vše lze měnit
-je možné použít i samostatné formátovní a nic nepřepočítávat **(libs\NumberFormat.php)**
-ve výchozím nastavení se stahují základní měny
-podpora zobrazení cen s dph
-korekcre kurzu, tzn. lze procentuelně zvednout kurz, či snížit
-samozřejmě umí vypisovat i jenom kurz


Formátování výstupu
---------------
"Api je jednoduché":https://github.com/h4kuna/Exchange/blob/master/libs/NumberFormat.php, jedná se o rozšíření pro number_format() jako že jsem viděl mockrát jaký s tím jsou problémy.
/--php
//první parametr volíme symbol: NULL, měnu, jednotku, cokoliv
$n = new \Exchange\NumberFormat('GB');

//formátování probíhá podle masky '1 S', kde 1 = číslo, S = symbol
$n->number = 1000.2;

echo $n; //1 000,20 GB

//vypne nedělitelné mezery, defaultně jsou zapnuté
$n->toggleNbsp();

//nechceme zbytečné nuly za desetinou čárkou
$n->toggleZeroClear();
echo $n; //1 000,2 GB

$n->number = 500;
echo $n; //500 GB

//změna zobrazení
$n->mask = 'S 1';
echo $n; //GB 500

\--

Config
-------------
/--
common:
	parameters:
		vat: 1.2
		currency: CZK

	services:
# následující dvě services nejsou povinné pokud je nebudete měnit
#        eDownload:
#            class: Exchange\CnbDay

#        eFormat:
#             class: Exchange\NumberFormat

        eSection:
            class: Nette\Http\SessionSection(@session, 'exchange')
            setup:
                - setExpiration('+30 days')

        eStorage:
            class: Exchange\CnbStorage

        exchange:
            class: \Exchange\Exchange
            setup:
                - setVat(%vat%)
                - loadCurrency(%currency%, {decimal: 0, symbol: Kč}) # pořadí zároveň definuje výchozí měnu
                - loadCurrency('usd', {symbol: $ })# první parametr je kód měny, druhý je pole, klíč je vlastnost objektu NumberFormat
\--

Nette\Templates
---------------
Službu si zaregistrujte v presenture jako helper do šablony, je pro to připravená metoda
/--php
$this->context->exchange->registerAsHelper($this->template);
\--


**default.phtml**
/--php
{!$a=10|currency} //10 Kč
<br/>
{foreach $exchange as $code => $data}
$exchange->currencyLink($code);
{/foreach}

{!$vat} // proměnná pro url = dph
//další možnosti formátovaní
{!$a|currency:eur:usd} //převede eura na dolary a zformatuje: $14.71
{!$a|currency:eur:usd:1.1} //to samé jen se zvedne cena o 10% třeba daň :) "kamarád stát"
//vstupní parametry helperu currency jsou stejné jako pro metodu format()
\--

v url pro viditelné změny stačí přidat **?currency=usd&vat=1**


Budoucnost
----------
-vytváření grafů
-lepší práce s historií

Historie
--------
přesunuta do README na githubu

{{tags: php, čnb, skript, kurz, currency, měna, exchange}}


{{author: h4kuna|1966}}
