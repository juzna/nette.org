Ajax s jQuery
#############

Řešení ajaxu pro Nette pomocí jQuery.

|Verze | 0.1
|Download | [jquery.nette.js | attachment:jquery.nette.js]
|Forum thread | http://forum.nette.org/cs/1300-neco-jako-nette-js-s-jquery
|Autor | Jan Marek
|Licence | MIT

Instalace
=========

Stáhněte soubor [jquery.nette.js | attachment:jquery.nette.js] a nalinkujte ho do stránky.

/--code js
/**
 * AJAX Nette Framwork plugin for jQuery
 *
 * @copyright  Copyright (c) 2009 Jan Marek
 * @license    MIT
 * @link       http://addons.nette.org/cs/jquery-ajax
 * @version    0.1
 */

jQuery.extend({
        updateSnippet: function (id, html) {
                $("#" + id).html(html);
        },

        netteCallback: function (data) {
                // redirect
                if (data.redirect) {
                        window.location.href = data.redirect;
                }

                // snippets
                if (data.snippets) {
                        for (var i in data.snippets) {
                                jQuery.updateSnippet(i, data.snippets[i]);
                        }
                }
        }
});

jQuery.ajaxSetup({
        success: jQuery.netteCallback,
        dataType: "json"
});
\--

Zdrojový kód je velice jednoduchý a mělo by být na první pohled jasné, co plugin dělá.


Příklad použití
===============

Stačí běžné zavolání nějaké [ajaxovací funkce z jQuery | http://docs.jquery.com/Ajax]:

/--code js
$.post("someUrl");
$.get("someUrl");
\--

Použití v unobtrusive javascriptu
-----------------------------------

Následující kód po načtení stránky přiřadí všem současným i v budoucnu vzniklým odkazům s třídou ajax po kliknutí ajaxové zpracování.

/--code js
$(function () {
	$("a.ajax").live("click", function () {
		$.get(this.href);
		return false;
	});
});
\--

Volání vlastního callbacku
--------------------------

Pokud zavoláte ajaxovací funkci z vlastní callbackem, tak se přepíše globální nette callback. Ovšem ten se dá explicitně zavolat.

/--code js
$.get("someUrl", function (data) {
	$.netteCallback(data);
	doSomethingElse();
});
\--

Vlastní efekt pro update snippetu
---------------------------------

Dá se přepsat metoda `$.updateSnippet` (zavedená tímto pluginem), například takto:

/--code js
jQuery.extend({
        updateSnippet: function (id, data) {
                $("#" + id).fadeOut("fast", function () {
                        $(this).html(data).fadeIn("fast");
                });
        }
});
\--

Efekty s točícím kolečkem
-------------------------

Se dají přidělat pomocí klasického jQuery.

/--code js
$(function () {
	// vhodně nastylovaný div vložím po načtení stránky
	$('<div id="ajax-spinner"></div>').ajaxStart(function () {
		// po ajaxStartu ukážu
		$(this).show();
	}).ajaxStop(function () {
		// a při ajaxStopu schovám
		$(this).hide();
	}).appendTo("body").hide();
});
\--

CSS:

/--code css
#ajax-spinner {
	position:fixed;
	left: 50%;
	top: 50%;
	margin: -15px 0 0 -15px;
	background: white url('../images/ajax-loader.gif') no-repeat 50% 50%;
	padding: 13px;
	border: 2px solid #CCC;
	font-size: 0;
}
\--

Točící kolečko na místě kliknutí na odkaz
-----------------------------------------

/--code js
$(function () {
	// zajaxovatění odkazů
	$("a.ajax").live("click", function (event) {
		$.get(this.href);

		// nastavení pozice spinneru
		$("#ajax-spinner").css({
			position: "absolute",
			left: event.pageX + 20,
			top: event.pageY + 40
		});

		return false;
	});

	// přidám spinner do stránky
	$('<div id="ajax-spinner"></div>').hide().ajaxStart(function () {
		$(this).show();
	}).ajaxStop(function () {
		// nastavení původních vlastností, třeba kvůli odesílání formuláře
		$(this).hide().css({
			position: "fixed",
			left: "50%",
			top: "50%"
		});
	});

});
\--
Historie
********

Viz také: .[see]
- [Ajaxové formuláře | addons:cs/ajax form]


{{extras}}

{{attachment: jquery.nette.js}}

{{author: Honza Marek|516}}
